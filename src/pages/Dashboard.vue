<template>
  <CheckoutPortal v-if="id" :product="id" />
  <div class="flex-dashboard">
    <div id="setting" class="flex-item">
      <SettingCard />
    </div>
    <div id="progressions" class="flex-item">
      <Progressions />
    </div>
  </div>
</template>

<script>
import { mapState } from 'vuex';
import swal from 'sweetalert2';
import CheckoutPortal from '@/organisms/CheckoutPortal.vue';
import SettingCard from '@/organisms/SettingCard.vue';
import Progressions from '@/organisms/Progressions.vue';

export default {
  name: 'Account',
  components: {
    CheckoutPortal,
    SettingCard,
    Progressions,
  },
  created() {
    this.$store.commit('app/SET_TITLES', { title: 'My_Account' });
  },
  computed: {
    ...mapState({
      translate: (state) => state.lang,
    }),
  },
  data() {
    return {
      id: null,
    };
  },
  methods: {
    checkIfLoggedIn() {
      if (!this.$store.getters.connected) {
        const redirect = '/';
        this.$store.dispatch('app/logAndRoute', { redirect });
      }
    },
    subscribeTo(id) {
      if (!this.$store.state.user.verified) { // dashboard watch $route
        swal.fire({ html: this.translate.NeedaBeVerifiedToSub });
      } else {
        this.id = id;
      }
    },
  },
  mounted() {
    const id = this.$route.query.s || null;
    this.checkIfLoggedIn();

    if (id) this.subscribeTo(id);
  },
  watch: {
    $route() {
      const id = this.$route.query.s || null;

      this.subscribeTo(id);
    },
  },
};
</script>

<style scoped>
.flex-dashboard {
  display: flex;
  width: stretch;
  height: stretch;
  flex-flow: row wrap;
  justify-content: space-around;
  gap: 1em;
  overflow-y: scroll;
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none; /* Firefox */
  padding: 2em;
}
#flex-dashboard:-webkit-scrollbar {
  display: none; /* Other browsers */
}

.flex-item {
  width: calc(50% - 3em);
  min-width: calc(500px - 3em);
  display: flex;
  flex-flow: column;
  align-items: center;
}

@media only screen and (max-width: 1000px) {
  .flex-item {
    min-width: 100%;
  }
}
</style>
